<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Nutrition OS</title>
    <style>
        :root {
            --primary: #2E7D32;
            --primary-light: #E8F5E9;
            --secondary: #1565C0;
            --secondary-light: #E3F2FD;
            --accent: #FF6F00;
            --dark: #263238;
            --light: #f4f7f6;
            --white: #ffffff;
            --danger: #c62828;
            --radius: 16px;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            margin: 0;
            padding-bottom: 80px; /* Space for bottom nav */
        }

        /* HEADER */
        header {
            background: var(--primary);
            color: var(--white);
            padding: 20px 20px 30px 20px;
            border-radius: 0 0 24px 24px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 10;
        }

        h1 { margin: 0; font-size: 1.5rem; font-weight: 800; }
        .subtitle { opacity: 0.9; font-size: 0.9rem; margin-top: 5px; }

        /* DAY NAVIGATOR */
        .day-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--white);
            margin: -20px 20px 20px 20px;
            padding: 10px;
            border-radius: 50px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 20;
        }

        .nav-btn {
            background: var(--primary-light);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .current-day-display {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* CONTAINER */
        .container { max-width: 600px; margin: 0 auto; padding: 0 20px; }

        /* MEAL CARDS */
        .timeline-item {
            position: relative;
            padding-left: 20px;
            margin-bottom: 25px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: -25px;
            width: 2px;
            background: #e0e0e0;
        }

        .timeline-item:last-child::before { display: none; }

        .time-bubble {
            position: absolute;
            left: -6px;
            top: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 3px solid var(--white);
            background: var(--primary);
        }

        .meal-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
            border-left: 5px solid var(--primary);
        }

        .meal-card.dinner { border-left-color: var(--accent); }
        .meal-card.dinner .time-badge { background: var(--accent); }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .time-badge {
            background: var(--primary);
            color: var(--white);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .dish-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin: 8px 0 4px 0;
            color: var(--dark);
        }

        .dish-desc { color: #666; font-size: 0.95rem; margin-bottom: 12px; font-style: italic; }

        /* TAGS */
        .tags { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 12px; }
        .tag {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            background: #eee;
            color: #555;
        }
        .tag.protein { background: #FFF3E0; color: #E65100; }
        .tag.iron { background: #F3E5F5; color: #7B1FA2; }
        .tag.fiber { background: #E8F5E9; color: #2E7D32; }

        /* ALERTS / NOTES */
        .alert-box {
            background: var(--primary-light);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }

        .alert-item {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            align-items: flex-start;
        }
        .alert-item:last-child { margin-bottom: 0; }
        .alert-icon { font-size: 1.1rem; min-width: 20px; }
        .alert-text b { color: var(--primary); }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .nav-tab {
            text-align: center;
            color: #999;
            font-size: 0.8rem;
            cursor: pointer;
            background: none;
            border: none;
        }

        .nav-tab.active { color: var(--primary); font-weight: bold; }
        .nav-icon { display: block; font-size: 1.5rem; margin-bottom: 2px; }

        /* VIEWS */
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }

        /* FAMILY PROFILE STYLES */
        .profile-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--secondary);
        }
        .profile-name { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; color: var(--secondary); }
        .profile-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; margin-bottom: 10px; }
        .stat-box { background: var(--secondary-light); padding: 8px; border-radius: 6px; text-align: center; }
        .stat-val { font-weight: bold; display: block; font-size: 1rem; }
        .stat-label { font-size: 0.7rem; opacity: 0.7; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* TOGGLE SWITCH */
        .mode-toggle {
            text-align: center; margin-bottom: 15px;
        }
        .toggle-btn {
            background: none; border: 1px solid var(--primary);
            color: var(--primary); padding: 5px 15px; border-radius: 20px;
            cursor: pointer; font-size: 0.8rem;
        }
        .toggle-btn.active { background: var(--primary); color: white; }

    </style>
</head>
<body>

    <header>
        <h1>Family Nutrition OS</h1>
        <div class="subtitle">Single Kitchen ‚Ä¢ Healthy Weight Loss</div>
    </header>

    <div id="view-plan" class="view-section active">
        
        <div class="container">
            <div class="day-nav">
                <button class="nav-btn" onclick="changeDay(-1)">‚Äπ</button>
                <div class="current-day-display">
                    <span id="day-number">Day 1</span>
                    <div style="font-size: 0.8rem; font-weight: normal; color: #666; text-align: center;" id="day-focus">Gut Reset</div>
                </div>
                <button class="nav-btn" onclick="changeDay(1)">‚Ä∫</button>
            </div>

            <div class="mode-toggle">
                <button id="btn-guided" class="toggle-btn active" onclick="setMode('guided')">30-Day Plan</button>
                <button id="btn-random" class="toggle-btn" onclick="setMode('random')">Randomizer</button>
            </div>

            <div id="timeline-container">
                </div>
        </div>
    </div>

    <div id="view-profile" class="view-section">
        <div class="container" style="padding-top: 20px;">
            <h2 style="margin-bottom: 20px;">Family Goals</h2>
            <div id="profiles-container">
                </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-tab active" onclick="switchView('plan')">
            <span class="nav-icon">üìÖ</span> Plan
        </button>
        <button class="nav-tab" onclick="switchView('profile')">
            <span class="nav-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> Profile
        </button>
        <button class="nav-tab" onclick="alert('Generate your list from the 30-Day CSV provided!')">
            <span class="nav-icon">üõí</span> List
        </button>
    </div>

<script>
    // --- 1. FAMILY DATA ---
    const family = [
        { name: "P A Manjunath", age: 64, bmi: 34.2, goal: "Weight Loss", target: "2,050 kcal", notes: "Avoid carb spikes. 2 Eggs mandatory with rice meals." },
        { name: "P M Lakshmi", age: 61, bmi: 30.1, goal: "Joint Health", target: "1,550 kcal", notes: "Needs Calcium & Vitamin D. Light dinners." },
        { name: "P M Naga Chethan", age: 33, bmi: 30.4, goal: "Muscle/Fat Loss", target: "1,750 kcal", notes: "High Protein Anchor snack is critical." },
        { name: "Niveda V", age: 33, bmi: 28.0, goal: "Pre-Pregnancy", target: "1,600 kcal", notes: "Folic Acid, Iron, Good Fats. No skipping meals." }
    ];

    // --- 2. THE 30-DAY SCHEDULE (The Master Plan) ---
    const plan30 = [
        { day: 1, focus: "Gut Reset", tonic: "Golden Mix (Ginger)", brunch: "Moongdal Dosa (Pesarattu) + Ginger Chutney", snack: "Protein Shake (Seeds/Makhana)", dinner: "Moringa Soup + Cucumber Salad", note: "Soak Chana for Day 2." },
        { day: 2, focus: "Protein Boost", tonic: "Green Juice", brunch: "Chickpea One Pot Rice + Raita", snack: "Sprouted Moong Tikki Chat", dinner: "Pumpkin Soup + Makhana", note: "Double chickpeas for Chethan." },
        { day: 3, focus: "Iron Load", tonic: "Golden Mix (Beetroot)", brunch: "Ragi Mudde + Bassaru (Greens) + Palya", snack: "High Protein Veg Omelette", dinner: "Vegetable Kuut + 1 Toast", note: "Niveda must finish the Greens (Palya)." },
        { day: 4, focus: "Fiber Rich", tonic: "Methi Water", brunch: "Bisibele Bath (Brown Rice) + Chips", snack: "Boiled Rajma Patties", dinner: "Winter Salad (Lettuce/Carrot)", note: "Manjunath: Eat 2 Boiled eggs (Carb heavy brunch)." },
        { day: 5, focus: "Treat Day", tonic: "Celery Juice", brunch: "Jowar Roti + Gutti Vankaya", snack: "Makhana & Nuts Bowl", dinner: "Sabudana Momos (Steamed)", note: "Steamed momos only." },
        { day: 6, focus: "Traditional", tonic: "Golden Mix (Fenugreek)", brunch: "Millet Pongal + Coconut Chutney", snack: "Chickpea Salad (Sundal)", dinner: "Green Dal Soup + Carrots", note: "Grind Idli batter tonight." },
        { day: 7, focus: "Sunday Special", tonic: "Amla Kanji", brunch: "Idli + Drumstick Sambar", snack: "Sweet Potato Brownie (1pc)", dinner: "Rice Paper Rolls", note: "Optional Chicken/Fish side for Kids." },
        { day: 8, focus: "Citrus/Vit C", tonic: "Golden Mix (Orange)", brunch: "Lemon Rice + Kosambari", snack: "Protein Shake", dinner: "Broccoli Soup + Pepper", note: "Manjunath: Mandatory 2 Eggs with Lemon Rice." },
        { day: 9, focus: "Kidney Health", tonic: "Green Juice", brunch: "Chapathi + Rajma Curry", snack: "Corn & Chana Salad", dinner: "Smashed Potato Salad", note: "Soak Horsegram." },
        { day: 10, focus: "Fat Burn", tonic: "Golden Mix (Ginger)", brunch: "Horsegram Curry + Ragi Roti", snack: "Veggie Balls", dinner: "Moringa Soup", note: "Horsegram is thermogenic." },
        // ... Days 11-30 are logically generated below to save space in code, following the CSV pattern
    ];

    // Filling Days 11-30 with rotation logic from DB to ensure full functionality
    const db = {
        tonics: ["Golden Mix (Ginger)", "Green Juice", "Beetroot Kanji", "Ash Gourd Juice", "Probiotic Soda"],
        bases: ["Quinoa Khichdi", "Soya Pulav", "Daliya Upma", "Set Dosa", "Whole Moong Curry", "Akki Roti", "Palak Pappu", "Alasandala Curry", "Moringa Dosa", "Billa Kudumulu", "Veg Biryani", "Curd Rice", "Ragi Paratha", "Black Channa", "Vermicelli Upma", "Gongura Pappu", "Appam", "Drumstick Pulusu", "Methi Thepla", "Leftovers"],
        snacks: ["Rice Crispers", "Moong Tikki", "Chickpea Sundal", "Makhana Bowl", "Protein Shake", "Rajma Patties", "Sweet Potato Truffle", "Chickpea Sundal", "Veg Omelette", "Corn Salad", "Protein Shake", "Moong Tikki", "Brownie", "Rajma Patties", "Rice Crispers", "Chickpea Sundal", "Protein Shake", "Veggie Balls", "Corn Salad", "Protein Shake"],
        dinners: ["Cauliflower Bowl", "Kimchi Rice", "Tomato Rasam", "Zoodles", "Squash Soup", "Winter Salad", "Rice Paper Dumplings", "Horsegram Soup", "Green Dal Soup", "Moringa Soup", "Fruit Bowl", "Beetroot Kanji", "Brownie + Milk", "Clear Soup", "Rice Paper Rolls", "Pumpkin Soup", "Potato Salad", "Tomato Rasam", "Moringa Soup", "Salad + Night Shots"]
    };

    // Generate rest of the days based on your list
    for(let i=10; i<30; i++) {
        plan30.push({
            day: i+1,
            focus: "Health Goal",
            tonic: db.tonics[i % db.tonics.length],
            brunch: db.bases[i-10],
            snack: db.snacks[i-10],
            dinner: db.dinners[i-10],
            note: "Check Family Profile for portion rules."
        });
    }

    // --- 3. APP STATE & LOGIC ---
    let currentDayIndex = 0;
    let mode = 'guided'; // 'guided' or 'random'

    function renderApp() {
        const data = mode === 'guided' ? plan30[currentDayIndex] : generateRandomDay();
        
        document.getElementById('day-number').innerText = `Day ${data.day || '?'}`;
        document.getElementById('day-focus').innerText = data.focus || 'Random Mix';
        
        const html = `
            <div class="timeline-item">
                <div class="time-bubble"></div>
                <div class="meal-card">
                    <div class="card-header">
                        <span class="time-badge">7:00 AM ‚Ä¢ Morning Tonic</span>
                        <div class="tags"><span class="tag fiber">Gut Health</span></div>
                    </div>
                    <div class="dish-title">${data.tonic}</div>
                    <div class="alert-box">
                        <div class="alert-item">
                            <span class="alert-icon">üíä</span>
                            <span class="alert-text"><b>Parents:</b> If taking meds, eat 5 Soaked Almonds.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timeline-item">
                <div class="time-bubble"></div>
                <div class="meal-card">
                    <div class="card-header">
                        <span class="time-badge">12:30 PM ‚Ä¢ Big Brunch</span>
                        <div class="tags"><span class="tag protein">Main Meal</span></div>
                    </div>
                    <div class="dish-title">${data.brunch}</div>
                    <div class="dish-desc">Served with Salad/Palya</div>
                    <div class="alert-box">
                        <div class="alert-item">
                            <span class="alert-icon">ü•ö</span>
                            <span class="alert-text"><b>Manjunath:</b> ${isCarbHeavy(data.brunch) ? 'MANDATORY: Add 2 Boiled Eggs.' : 'Portion control on Rice.'}</span>
                        </div>
                         <div class="alert-item">
                            <span class="alert-icon">ü•¨</span>
                            <span class="alert-text"><b>Niveda:</b> Ensure you finish the side greens.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timeline-item">
                <div class="time-bubble"></div>
                <div class="meal-card">
                    <div class="card-header">
                        <span class="time-badge">4:30 PM ‚Ä¢ Protein Anchor</span>
                        <div class="tags"><span class="tag iron">Critical</span></div>
                    </div>
                    <div class="dish-title">${data.snack}</div>
                    <div class="alert-box">
                        <div class="alert-item">
                            <span class="alert-icon">üí™</span>
                            <span class="alert-text"><b>Chethan:</b> Do not skip. Prevents dinner overeating.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timeline-item">
                <div class="time-bubble"></div>
                <div class="meal-card dinner">
                    <div class="card-header">
                        <span class="time-badge">7:30 PM ‚Ä¢ Light Dinner</span>
                        <div class="tags"><span class="tag">Gut Reset</span></div>
                    </div>
                    <div class="dish-title">${data.dinner}</div>
                    <div class="dish-desc">Keep it light. No heavy grains.</div>
                    <div class="alert-box">
                        <div class="alert-item">
                            <span class="alert-icon">üìù</span>
                            <span class="alert-text"><b>Prep:</b> ${data.note || 'Check grocery list for tomorrow.'}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="time-bubble"></div>
                <div class="meal-card" style="padding:15px; background: #fafafa; border-left-color: #555;">
                     <div class="dish-title" style="font-size: 1rem; margin:0;">üåô Night Shots</div>
                     <div class="dish-desc" style="margin:0">Turmeric, Nutmeg, Poppy Seeds (Warm Milk/Water)</div>
                </div>
            </div>
        `;

        document.getElementById('timeline-container').innerHTML = html;
    }

    function renderProfiles() {
        const html = family.map(p => `
            <div class="profile-card">
                <div class="profile-name">${p.name}</div>
                <div class="profile-stats">
                    <div class="stat-box"><span class="stat-val">${p.bmi}</span><span class="stat-label">BMI</span></div>
                    <div class="stat-box"><span class="stat-val">${p.target}</span><span class="stat-label">Calories</span></div>
                </div>
                <div style="font-size: 0.9rem; color: #444;">üéØ <b>Goal:</b> ${p.goal}</div>
                <div style="font-size: 0.9rem; color: #444; margin-top:5px;">‚ö†Ô∏è <b>Note:</b> ${p.notes}</div>
            </div>
        `).join('');
        document.getElementById('profiles-container').innerHTML = html;
    }

    // --- HELPERS ---
    function isCarbHeavy(mealName) {
        const carbs = ['Rice', 'Poha', 'Upma', 'Biryani', 'Bath', 'Pongal', 'Mudde'];
        return carbs.some(c => mealName.includes(c));
    }

    function changeDay(dir) {
        if(mode === 'random') { renderApp(); return; }
        currentDayIndex += dir;
        if(currentDayIndex < 0) currentDayIndex = 29;
        if(currentDayIndex > 29) currentDayIndex = 0;
        renderApp();
    }

    function setMode(m) {
        mode = m;
        document.getElementById('btn-guided').className = m === 'guided' ? 'toggle-btn active' : 'toggle-btn';
        document.getElementById('btn-random').className = m === 'random' ? 'toggle-btn active' : 'toggle-btn';
        if(m === 'random') document.querySelector('.day-nav button').style.display = 'none';
        else document.querySelector('.day-nav button').style.display = 'block';
        renderApp();
    }

    function generateRandomDay() {
        return {
            day: '‚àû',
            focus: 'Mix & Match',
            tonic: db.tonics[Math.floor(Math.random()*db.tonics.length)],
            brunch: db.bases[Math.floor(Math.random()*db.bases.length)],
            snack: db.snacks[Math.floor(Math.random()*db.snacks.length)],
            dinner: db.dinners[Math.floor(Math.random()*db.dinners.length)],
            note: "Ensure balanced plate composition."
        };
    }

    function switchView(viewName) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById(`view-${viewName}`).classList.add('active');
        
        document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    // --- INIT ---
    renderApp();
    renderProfiles();

</script>
</body>
</html>
