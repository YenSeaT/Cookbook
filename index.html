<!DOCTYPE html>
<html lang="en" data-theme="nature">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Functional Gut Kitchen</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. THEME VARIABLES --- */
        :root {
            --transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius: 16px;
        }

        /* Nature Theme (Default) */
        [data-theme="nature"] {
            --primary: #2e7d32;
            --primary-light: #e8f5e9;
            --secondary: #ff8f00;
            --bg-body: #f4f6f5;
            --bg-card: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --gradient-1: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
        }

        /* Ocean Theme */
        [data-theme="ocean"] {
            --primary: #0288d1;
            --primary-light: #e1f5fe;
            --secondary: #ff4081;
            --bg-body: #f0f8ff;
            --bg-card: #ffffff;
            --text-main: #1a237e;
            --text-muted: #5c6bc0;
            --border: #e3f2fd;
            --gradient-1: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --primary: #66bb6a;
            --primary-light: #1b2e1e;
            --secondary: #ffa726;
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --border: #333333;
            --gradient-1: linear-gradient(135deg, #434343 0%, #000000 100%);
        }

        /* --- 2. GLOBAL STYLES --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            transition: background-color var(--transition), color var(--transition);
        }

        h1, h2, h3, h4 { font-family: 'Poppins', sans-serif; margin: 0; }

        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* --- 3. HEADER & CONTROLS --- */
        .app-header {
            background: var(--bg-card);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 2rem;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo-area { display: flex; align-items: center; gap: 10px; }
        .logo-icon { 
            font-size: 1.8rem; 
            color: var(--primary); 
            background: var(--primary-light);
            padding: 10px;
            border-radius: 12px;
        }
        
        .header-actions { display: flex; gap: 10px; }

        /* Search Bar */
        .search-wrapper {
            position: relative;
            flex-grow: 1;
            max-width: 500px;
            margin: 0 auto;
        }
        .search-wrapper i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        #searchInput {
            width: 100%;
            padding: 12px 12px 12px 45px;
            border-radius: 50px;
            border: 2px solid var(--border);
            background: var(--bg-body);
            color: var(--text-main);
            font-size: 1rem;
            outline: none;
            transition: var(--transition);
        }
        #searchInput:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }

        /* Buttons */
        .btn {
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .btn-primary { background: var(--primary); color: #fff; box-shadow: 0 4px 10px rgba(46, 125, 50, 0.2); }
        .btn-primary:hover { transform: translateY(-2px); filter: brightness(110%); }
        
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        .btn-outline:hover { background: var(--primary-light); color: var(--primary); border-color: var(--primary); }
        
        .btn-icon { padding: 10px; border-radius: 50%; width: 40px; height: 40px; justify-content: center; }

        /* Filters */
        .filter-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        .filter-scroll::-webkit-scrollbar { display: none; }

        .filter-chip {
            white-space: nowrap;
            padding: 8px 16px;
            border-radius: 25px;
            background: var(--bg-body);
            color: var(--text-muted);
            border: 1px solid var(--border);
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        .filter-chip:hover { background: var(--border); }
        .filter-chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- 4. GRID & LIST LAYOUTS --- */
        .container { padding: 2rem; max-width: 1400px; margin: 0 auto; }

        /* Grid View (Default) */
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        /* List View (Toggled via JS) */
        .layout-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* --- 5. CARD DESIGN --- */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }

        /* Card Visual Header */
        .card-visual {
            height: 100px;
            position: relative;
            background: var(--gradient-1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Category specific gradients */
        .card[data-cat="Beverages"] .card-visual { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        .card[data-cat="Snacks"] .card-visual { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
        .card[data-cat="Salads"] .card-visual { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
        .card[data-cat="Soups"] .card-visual { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); }
        .card[data-cat="Breakfast"] .card-visual { background: linear-gradient(120deg, #f093fb 0%, #f5576c 100%); }
        .card[data-cat="Main"] .card-visual { background: linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%); }
        .card[data-cat="Sides"] .card-visual { background: linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%); }
        .card[data-cat="Dessert"] .card-visual { background: linear-gradient(to right, #43e97b 0%, #38f9d7 100%); }

        .card-icon {
            font-size: 2rem;
            color: rgba(255,255,255,0.9);
        }

        .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }

        .tag-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .tag {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 700;
            background: rgba(0,0,0,0.05);
            color: var(--text-muted);
        }

        .card-title {
            font-size: 1.25rem;
            color: var(--text-main);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .meta-row {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .meta-item { display: flex; align-items: center; gap: 6px; }

        .notes-preview {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.5;
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .btn-note {
            background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.1rem;
            transition: color 0.2s;
        }
        .btn-note:hover, .btn-note.has-note { color: var(--secondary); }

        .btn-link {
            text-decoration: none;
            background: var(--primary-light);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: var(--transition);
        }
        .btn-link:hover { background: var(--primary); color: white; }

        /* User Note Area (Hidden by default) */
        .user-note-area {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border);
        }
        .user-note-area.active { display: block; animation: slideDown 0.3s ease; }
        .user-note-area textarea {
            width: 100%;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            font-family: inherit;
            background: var(--bg-body);
            color: var(--text-main);
            resize: vertical;
            min-height: 60px;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- LIST VIEW OVERRIDES --- */
        .layout-list .card {
            flex-direction: row;
            align-items: center;
            height: auto;
        }
        .layout-list .card-visual {
            width: 120px;
            height: 100%; /* Stretch full height */
            min-height: 140px;
            flex-shrink: 0;
        }
        .layout-list .card-body {
            flex-direction: row;
            align-items: center;
            gap: 20px;
            padding: 15px 25px;
        }
        .layout-list .card-content-wrapper { flex-grow: 1; }
        .layout-list .meta-row { margin-bottom: 0; padding-bottom: 0; border: none; display: inline-flex; margin-left: 15px; }
        .layout-list .notes-preview { display: none; } /* Hide notes in list view for compactness */
        .layout-list .user-note-area { width: 100%; }
        
        /* Mobile List View Fallback */
        @media (max-width: 768px) {
            .layout-list .card { flex-direction: column; align-items: stretch; }
            .layout-list .card-visual { width: 100%; height: 80px; min-height: 80px; }
            .layout-list .card-body { flex-direction: column; align-items: flex-start; gap: 10px; }
            .layout-list .meta-row { margin-left: 0; margin-top: 5px; }
            .header-top { justify-content: center; }
            .search-wrapper { width: 100%; order: 3; margin-top: 10px; }
        }

        /* --- MODAL --- */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--bg-card);
            margin: 5% auto;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }
        .modal-header { text-align: center; margin-bottom: 25px; }
        .close { position: absolute; right: 25px; top: 20px; font-size: 24px; cursor: pointer; color: var(--text-muted); }
        
        .plan-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            gap: 15px;
        }
        .plan-time {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--secondary);
            width: 80px;
            flex-shrink: 0;
        }
        .plan-detail h4 { font-size: 1rem; color: var(--text-main); margin-bottom: 4px; }
        .plan-detail span { font-size: 0.85rem; color: var(--text-muted); }

    </style>
</head>
<body>

    <header class="app-header">
        <div class="header-top">
            <div class="logo-area">
                <div class="logo-icon"><i class="fas fa-leaf"></i></div>
                <div>
                    <h1>Functional Gut Kitchen</h1>
                    <small style="color: var(--text-muted);">Immunity • Probiotics • Metabolism</small>
                </div>
            </div>

            <div class="search-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search ingredients, recipes...">
            </div>

            <div class="header-actions">
                <button class="btn btn-outline btn-icon" id="themeToggle" title="Toggle Theme">
                    <i class="fas fa-palette"></i>
                </button>
                <button class="btn btn-outline btn-icon" id="viewToggle" title="Toggle View">
                    <i class="fas fa-list"></i>
                </button>
                <button class="btn btn-primary" id="randomDayBtn">
                    <i class="fas fa-magic"></i> <span style="margin-left:5px">Daily Plan</span>
                </button>
            </div>
        </div>

        <div class="filter-scroll" id="categoryFilters">
            </div>
    </header>

    <div class="container">
        <div id="recipeGrid" class="layout-grid">
            </div>
    </div>

    <div id="planModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 style="color:var(--primary);">Your Daily Fuel Plan</h2>
                <p style="color:var(--text-muted);">A balanced selection for gut health & recovery</p>
            </div>
            <div id="dailyPlanContainer"></div>
            <div style="text-align: center; margin-top: 25px;">
                <button id="regenerateBtn" class="btn btn-outline"><i class="fas fa-sync-alt"></i> Shuffle Plan</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA (Full List) ---
        const recipes = [
             // I. Functional Beverages
            { name: "Nutritious Kanji", category: "Beverages", prep: "15m", cook: "3d", notes: "Beetroot/Amla base. Fermented probiotic. Use mustard seeds." },
            { name: "Kombucha", category: "Beverages", prep: "20m", cook: "7d", notes: "Requires SCOBY. Double fermentation for fizz." },
            { name: "Probiotic Ginger Bug Soda", category: "Beverages", prep: "10m", cook: "3d", notes: "Feed bug daily with ginger/sugar. Beetroot/Apple/Pom base." },
            { name: "Hibiscus Ginger Soda", category: "Beverages", prep: "10m", cook: "2d", notes: "Rich in Vitamin C. Use dried hibiscus petals." },
            { name: "Gond Katira Lemon Drink", category: "Beverages", prep: "8hr", cook: "5m", notes: "Tragacanth gum. Cooling and gut lining repair." },
            { name: "Golden Mix Shot (Var A)", category: "Beverages", prep: "5m", cook: "0m", notes: "Ginger, Turmeric, Amla, Carrot, Jeera." },
            { name: "Golden Mix Shot (Var B)", category: "Beverages", prep: "5m", cook: "0m", notes: "Beetroot base. High Nitric Oxide booster." },
            { name: "Golden Mix Shot (Var C)", category: "Beverages", prep: "5m", cook: "0m", notes: "Orange, Turmeric, Ginger, Carrot, Jeera." },
            { name: "Spiced Water (Detox)", category: "Beverages", prep: "2m", cook: "10m", notes: "Boil Fenugreek, Fennel, Jeera, Cinnamon, Ajwain." },
            { name: "Night Recovery Shot", category: "Beverages", prep: "5m", cook: "2m", notes: "Turmeric, Nutmeg, Saffron. Promotes deep sleep." },
            { name: "Superfood Protein Shake", category: "Beverages", prep: "1hr", cook: "5m", notes: "Pumpkin seeds, Makhana, Chia, Moringa. Soak & grind." },
            { name: "Anti-Allergy Elixir", category: "Beverages", prep: "10m", cook: "0m", notes: "Celery, Lemon, Ginger. Excellent for mucus control." },
            { name: "Matcha Tea", category: "Beverages", prep: "5m", cook: "2m", notes: "High antioxidant. Use ceremonial grade." },
            { name: "Green Juice", category: "Beverages", prep: "10m", cook: "0m", notes: "Spinach, Cucumber, Bottle gourd base." },

            // II. Healthy Snacks
            { name: "Maggi Thupka", category: "Snacks", prep: "10m", cook: "15m", notes: "Soup-based noodles with lots of veggies." },
            { name: "Slurrp Smart Zucchini Maggi", category: "Snacks", prep: "10m", cook: "5m", notes: "Use spiralized zucchini instead of refined flour noodles." },
            { name: "Low-carb Pesto Zoodles", category: "Snacks", prep: "10m", cook: "5m", notes: "Basil, pine nuts/walnuts, garlic sauce." },
            { name: "Soya Chilli Maggi", category: "Snacks", prep: "10m", cook: "10m", notes: "High protein soya chunks added." },
            { name: "Rice Paper Momos", category: "Snacks", prep: "20m", cook: "15m", notes: "Gluten-free outer layer (Vietnamese style)." },
            { name: "Spicy Glow Rolls", category: "Snacks", prep: "20m", cook: "0m", notes: "Rice paper rolls with raw veggies & dipping sauce." },
            { name: "Potato Hash Browns", category: "Snacks", prep: "10m", cook: "15m", notes: "Shallow fry or air fry. Minimal oil." },
            { name: "Quinoa Veggie Balls", category: "Snacks", prep: "15m", cook: "20m", notes: "Served with pepper dressing." },
            { name: "Chickpea Patties", category: "Snacks", prep: "8hr", cook: "20m", notes: "Falafel style or Tawa fry." },
            { name: "Boiled Rajma Patties", category: "Snacks", prep: "8hr", cook: "20m", notes: "Mash well, high fiber, high protein." },
            { name: "Spinach & Moong Patties", category: "Snacks", prep: "15m", cook: "15m", notes: "Green gram and spinach base." },
            { name: "Root Veggie Patties", category: "Snacks", prep: "15m", cook: "20m", notes: "Beetroot, Sweet Potato, Black Channa." },
            { name: "Sprouted Moong Tikki Chat", category: "Snacks", prep: "10m", cook: "10m", notes: "Sprouts base, shallow fried. Tangy." },
            { name: "Healthy Papdi Chat", category: "Snacks", prep: "5m", cook: "0m", notes: "Use crushed Khakra as base instead of fried papdi." },
            { name: "Vegan Stuffed Sweet Potato", category: "Snacks", prep: "5m", cook: "40m", notes: "Baked, stuffed with chickpeas & walnut herb sauce." },
            { name: "Peri Peri Crackers", category: "Snacks", prep: "10m", cook: "15m", notes: "Seed based (Flax, Sesame). Hormone friendly." },
            { name: "High Protein Rice Crispers", category: "Snacks", prep: "10m", cook: "15m", notes: "Puffed rice with protein powder/nuts." },
            { name: "Pongu Kodbele", category: "Snacks", prep: "15m", cook: "20m", notes: "Rice flour rings." },
            { name: "Water Chestnut Manchurian", category: "Snacks", prep: "15m", cook: "20m", notes: "Use Singhara flour. Fasting friendly." },

            // III. Salads
            { name: "Standard Chickpea Salad", category: "Salads", prep: "10m", cook: "0m", notes: "Cucumber, tomato, lemon dressing." },
            { name: "Achari Chickpea Salad", category: "Salads", prep: "10m", cook: "5m", notes: "Use mango pickle masala as dressing." },
            { name: "Creamy Cauliflower Bowl", category: "Salads", prep: "15m", cook: "15m", notes: "Roasted cauliflower, chickpea, tahini dressing." },
            { name: "Channa Power Bowl", category: "Salads", prep: "15m", cook: "0m", notes: "Mixed greens, seeds, paneer." },
            { name: "Corn & Black Channa Salad", category: "Salads", prep: "10m", cook: "0m", notes: "Boiled corn and black chickpeas." },
            { name: "Rajma Salad", category: "Salads", prep: "10m", cook: "0m", notes: "Kidney beans with onions and tomatoes." },
            { name: "Winter Veggies Salad", category: "Salads", prep: "15m", cook: "20m", notes: "Roasted carrots, beets, sweet potato." },
            { name: "Pumpkin & Moong Dal Salad", category: "Salads", prep: "10m", cook: "10m", notes: "Soaked moong dal (kosambari style)." },
            { name: "Smashed Potato Salad", category: "Salads", prep: "10m", cook: "20m", notes: "Boiled, smashed, roasted potatoes." },
            { name: "Carrot Noodles Salad", category: "Salads", prep: "10m", cook: "0m", notes: "Ribboned carrots with peanut dressing." },
            { name: "Makhana Salad", category: "Salads", prep: "5m", cook: "5m", notes: "Roasted foxnuts with veggies." },

            // IV. Soups
            { name: "Green Dal Soup", category: "Soups", prep: "5m", cook: "20m", notes: "Moong dal with spinach." },
            { name: "Horsegram Soup", category: "Soups", prep: "8hr", cook: "30m", notes: "Excellent for weight loss & generating body heat." },
            { name: "Moringa Soup", category: "Soups", prep: "5m", cook: "15m", notes: "Drumstick leaves clear soup." },
            { name: "Butternut Squash Soup", category: "Soups", prep: "10m", cook: "25m", notes: "Creamy, sweet, comforting." },
            { name: "Pumpkin Soup", category: "Soups", prep: "10m", cook: "25m", notes: "Rich in Vitamin A." },
            { name: "Mix Veg Ragi Soup", category: "Soups", prep: "10m", cook: "15m", notes: "Ragi flour slurry for thickening." },
            { name: "Broccoli Soup", category: "Soups", prep: "5m", cook: "15m", notes: "Pureed broccoli with almond milk." },

            // V. Breakfast
            { name: "Moongdal Roti", category: "Breakfast", prep: "10m", cook: "15m", notes: "Dal flour or cooked dal mixed in dough." },
            { name: "Ragi Paneer Paratha", category: "Breakfast", prep: "15m", cook: "15m", notes: "Stuffed with protein." },
            { name: "Moringa Chapathi", category: "Breakfast", prep: "10m", cook: "15m", notes: "Wheat/Millet flour + Moringa puree." },
            { name: "Spinach Chapathi", category: "Breakfast", prep: "10m", cook: "15m", notes: "Palak puree in dough." },
            { name: "Ragi/Rice Roti (Akki Roti)", category: "Breakfast", prep: "15m", cook: "15m", notes: "Karnataka style, pat on tawa." },
            { name: "Jeera Roti", category: "Breakfast", prep: "10m", cook: "15m", notes: "Digestive, simple." },
            { name: "Moongdal Dosa (Pesarattu)", category: "Breakfast", prep: "8hr", cook: "15m", notes: "Green gram dosa. Ginger/Jeera essential." },
            { name: "Moringa Keerai Dosa", category: "Breakfast", prep: "5m", cook: "10m", notes: "Mix leaves into standard batter." },
            { name: "High Protein Veg Omelette", category: "Breakfast", prep: "10m", cook: "10m", notes: "Besan (chickpea flour) base." },
            { name: "Bisi Bele Bath (Millet)", category: "Breakfast", prep: "15m", cook: "30m", notes: "Use foxtail millet instead of rice." },
            { name: "Poha", category: "Breakfast", prep: "5m", cook: "10m", notes: "Flattened rice with veggies." },
            { name: "Puliogare", category: "Breakfast", prep: "10m", cook: "20m", notes: "Tamarind rice." },
            { name: "Millet Veg Upma", category: "Breakfast", prep: "5m", cook: "15m", notes: "Loaded with veggies." },
            { name: "Millet Pongal", category: "Breakfast", prep: "10m", cook: "20m", notes: "Peppercorn and ginger tempering." },
            { name: "Ragi Mudde", category: "Breakfast", prep: "5m", cook: "15m", notes: "Finger millet balls. Swallow, don't chew." },
            { name: "Billa Kudumulu", category: "Breakfast", prep: "15m", cook: "20m", notes: "Steamed rice rava dumplings." },
            { name: "Daliya (Broken Wheat)", category: "Breakfast", prep: "5m", cook: "15m", notes: "Savory porridge." },

            // VI. Main Course
            { name: "Soya & Chickpea Pulav", category: "Main", prep: "20m", cook: "30m", notes: "High protein rice dish." },
            { name: "Chickpea One-Pot Rice", category: "Main", prep: "10m", cook: "25m", notes: "Pressure cooker meal." },
            { name: "Chickpea & Paneer Rice", category: "Main", prep: "10m", cook: "25m", notes: "Rich and filling." },
            { name: "Lemon Rice (Millet)", category: "Main", prep: "10m", cook: "15m", notes: "Turmeric and lemon for immunity." },
            { name: "Quinoa Khichdi", category: "Main", prep: "10m", cook: "20m", notes: "Lighter than rice khichdi." },

            // VII. Sides
            { name: "Lemon Dal Curry", category: "Sides", prep: "5m", cook: "20m", notes: "Tangy lentil soup." },
            { name: "Palak Pappu", category: "Sides", prep: "10m", cook: "25m", notes: "Spinach Dal (Andhra style)." },
            { name: "Gongura Pappu", category: "Sides", prep: "10m", cook: "25m", notes: "Sorrel leaves dal. High Iron." },
            { name: "Sorakayi Pappu", category: "Sides", prep: "10m", cook: "20m", notes: "Bottle Gourd Dal. Cooling." },
            { name: "Vegetable Kuut (Kootu)", category: "Sides", prep: "15m", cook: "20m", notes: "Coconut and lentil base." },
            { name: "Pacchi Pulusu", category: "Sides", prep: "10m", cook: "5m", notes: "Raw tamarind stew (Andhra style). No cooking." },
            { name: "Alasandala Pacchi Pulusu", category: "Sides", prep: "10m", cook: "15m", notes: "Black-eyed pea stew." },
            { name: "Munakkaya Pulusu", category: "Sides", prep: "10m", cook: "20m", notes: "Drumstick tangy tamarind gravy." },
            { name: "Bhendakaya Pulusu", category: "Sides", prep: "10m", cook: "20m", notes: "Okra in tamarind gravy." },
            { name: "Tomato Rasam", category: "Sides", prep: "5m", cook: "15m", notes: "Digestive soup." },
            { name: "Pepper Rasam", category: "Sides", prep: "5m", cook: "15m", notes: "Good for cold/throat." },
            { name: "Alasandala Curry", category: "Sides", prep: "8hr", cook: "25m", notes: "Black-eyed pea curry." },
            { name: "Black Channa Curry", category: "Sides", prep: "8hr", cook: "30m", notes: "Hardy, fiber rich." },
            { name: "Beans Palya", category: "Sides", prep: "10m", cook: "15m", notes: "French beans stir fry." },
            { name: "Dhondakaya Palya", category: "Sides", prep: "10m", cook: "15m", notes: "Ivy Gourd stir fry with coconut." },
            { name: "Chikkudukayi Palya", category: "Sides", prep: "10m", cook: "15m", notes: "Broad Beans stir fry." },
            { name: "Horsegram Curry", category: "Sides", prep: "8hr", cook: "30m", notes: "Thick gravy." },
            { name: "Kadal Curry", category: "Sides", prep: "8hr", cook: "30m", notes: "Kerala style black chickpea curry." },
            { name: "Karela Fry", category: "Sides", prep: "10m", cook: "20m", notes: "Bitter Gourd. Good for blood sugar." },
            { name: "Baigan Bharta", category: "Sides", prep: "10m", cook: "20m", notes: "Smoked eggplant mash." },
            { name: "Chole Masala", category: "Sides", prep: "8hr", cook: "30m", notes: "Classic chickpea curry." },
            { name: "Gutti Vankaya", category: "Sides", prep: "15m", cook: "25m", notes: "Stuffed brinjal curry." },
            { name: "Rajma Curry", category: "Sides", prep: "8hr", cook: "30m", notes: "Kidney beans gravy." },
            { name: "Jeera/Mango Gojju", category: "Sides", prep: "10m", cook: "15m", notes: "Karnataka style tangy curry." },
            { name: "Mangalore Dosakai Sambhar", category: "Sides", prep: "10m", cook: "25m", notes: "Yellow cucumber stew." },
            { name: "Sorakayi Perugu Pachadi", category: "Sides", prep: "10m", cook: "10m", notes: "Yogurt chutney with bottle gourd." },
            { name: "Pudina Chutney", category: "Sides", prep: "5m", cook: "5m", notes: "Mint chutney." },
            { name: "Sesame Chutney", category: "Sides", prep: "5m", cook: "5m", notes: "Rich in calcium." },

            // VIII. Desserts
            { name: "Sweet Potato Brownie", category: "Dessert", prep: "15m", cook: "30m", notes: "Use cacao powder, no refined sugar." },
            { name: "Sweet Potato Truffles", category: "Dessert", prep: "20m", cook: "0m", notes: "Mashed SP, dates, cocoa." },
            { name: "Salted Date Caramels", category: "Dessert", prep: "10m", cook: "0m", notes: "Dates blended with salt and vanilla." },
            { name: "Paan Cheesecake", category: "Dessert", prep: "20m", cook: "4hr", notes: "Dairy free. Cashew base with Gulkand." },
            { name: "Tiramisu (Oats)", category: "Dessert", prep: "10m", cook: "8hr", notes: "Coffee soaked oats. No mascarpone." },
            { name: "Homemade Fruit Caramels", category: "Dessert", prep: "15m", cook: "20m", notes: "Reduced fruit puree." },
            { name: "Mulberry/Blackberry Caramel", category: "Dessert", prep: "10m", cook: "5m", notes: "Fruit reduction sauce." },

            // IX. Condiments
            { name: "Fermented Kimchi", category: "Condiments", prep: "30m", cook: "5d", notes: "Spicy probiotic cabbage." },
            { name: "Pickled Onions", category: "Condiments", prep: "5m", cook: "24hr", notes: "Vinegar and beetroot for color." },
            { name: "Chipotle Sauce", category: "Condiments", prep: "10m", cook: "0m", notes: "Smoky spicy dip." },
            { name: "Moringa Complex Powder", category: "Condiments", prep: "10m", cook: "5m", notes: "Roast/Grind: Moringa, Curry leaves, Flax." }
        ];

        // --- 2. STATE MANAGEMENT ---
        const state = {
            filter: 'All',
            search: '',
            view: localStorage.getItem('gut_kitchen_view') || 'grid',
            theme: localStorage.getItem('gut_kitchen_theme') || 'nature'
        };

        // --- 3. DOM ELEMENTS ---
        const grid = document.getElementById('recipeGrid');
        const filterContainer = document.getElementById('categoryFilters');
        const searchInput = document.getElementById('searchInput');
        const themeBtn = document.getElementById('themeToggle');
        const viewBtn = document.getElementById('viewToggle');
        const randomBtn = document.getElementById('randomDayBtn');
        const modal = document.getElementById('planModal');

        // --- 4. ICON MAP (FontAwesome) ---
        const icons = {
            Beverages: "fa-glass-water",
            Snacks: "fa-cookie-bite",
            Salads: "fa-carrot",
            Soups: "fa-mug-hot",
            Breakfast: "fa-egg",
            Main: "fa-bowl-rice",
            Sides: "fa-utensils",
            Dessert: "fa-ice-cream",
            Condiments: "fa-jar"
        };

        // --- 5. INITIALIZATION ---
        function init() {
            setTheme(state.theme);
            setView(state.view);
            renderFilters();
            renderRecipes();
        }

        // --- 6. RENDER FUNCTIONS ---
        function renderFilters() {
            const categories = ["All", ...new Set(recipes.map(r => r.category))];
            filterContainer.innerHTML = categories.map(cat => 
                `<button class="filter-chip ${cat === state.filter ? 'active' : ''}" 
                  onclick="updateFilter('${cat}')">${cat}</button>`
            ).join('');
        }

        function renderRecipes() {
            // Filter Data
            const filtered = recipes.filter(r => {
                const matchCat = state.filter === 'All' || r.category === state.filter;
                const matchSearch = r.name.toLowerCase().includes(state.search) || 
                                    r.notes.toLowerCase().includes(state.search);
                return matchCat && matchSearch;
            });

            // Generate HTML
            grid.innerHTML = filtered.map((recipe, index) => {
                const icon = icons[recipe.category] || "fa-leaf";
                const noteId = `note-${index}`;
                const userNote = localStorage.getItem('gut_kitchen_note_' + recipe.name) || '';
                const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(recipe.name + " recipe")}`;

                return `
                <div class="card" data-cat="${recipe.category}">
                    <div class="card-visual">
                        <i class="fas ${icon} card-icon"></i>
                    </div>
                    
                    <div class="card-body">
                        <div class="card-content-wrapper">
                            <div class="tag-row">
                                <span class="tag">${recipe.category}</span>
                            </div>
                            <h3 class="card-title">${recipe.name}</h3>
                            
                            <div class="meta-row">
                                <div class="meta-item"><i class="far fa-clock"></i> ${recipe.prep} Prep</div>
                                <div class="meta-item"><i class="fas fa-fire-burner"></i> ${recipe.cook} Cook</div>
                            </div>
                            
                            <div class="notes-preview">
                                ${recipe.notes}
                            </div>
                        </div>

                        <div class="user-note-area ${userNote ? 'active' : ''}" id="area-${noteId}">
                             <textarea placeholder="Your tweaks & notes..." 
                                oninput="saveNote('${recipe.name}', this.value)">${userNote}</textarea>
                        </div>

                        <div class="card-footer">
                            <button class="btn-note ${userNote ? 'has-note' : ''}" 
                                onclick="toggleNoteArea('area-${noteId}')" 
                                title="Add private note">
                                <i class="fas fa-pen"></i>
                            </button>
                            <a href="${searchUrl}" target="_blank" class="btn-link">
                                Watch Recipe <i class="fas fa-arrow-right" style="font-size:0.7em; margin-left:4px"></i>
                            </a>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // --- 7. ACTIONS ---
        window.updateFilter = (cat) => {
            state.filter = cat;
            renderFilters(); // Re-render chips to show active state
            renderRecipes();
        };

        window.toggleNoteArea = (id) => {
            const el = document.getElementById(id);
            if (el.style.display === 'block') {
                el.style.display = 'none';
            } else {
                el.style.display = 'block';
                el.classList.add('active');
            }
        };

        window.saveNote = (name, val) => {
            localStorage.setItem('gut_kitchen_note_' + name, val);
        };

        searchInput.addEventListener('input', (e) => {
            state.search = e.target.value.toLowerCase();
            renderRecipes();
        });

        // Theme Toggle
        themeBtn.addEventListener('click', () => {
            const themes = ['nature', 'ocean', 'dark'];
            const currentIdx = themes.indexOf(state.theme);
            const nextIdx = (currentIdx + 1) % themes.length;
            setTheme(themes[nextIdx]);
        });

        function setTheme(themeName) {
            state.theme = themeName;
            document.documentElement.setAttribute('data-theme', themeName);
            localStorage.setItem('gut_kitchen_theme', themeName);
        }

        // View Toggle
        viewBtn.addEventListener('click', () => {
            const newView = state.view === 'grid' ? 'list' : 'grid';
            setView(newView);
        });

        function setView(viewName) {
            state.view = viewName;
            localStorage.setItem('gut_kitchen_view', viewName);
            
            // Toggle Icon
            viewBtn.innerHTML = viewName === 'grid' ? '<i class="fas fa-list"></i>' : '<i class="fas fa-th-large"></i>';
            
            // Toggle Layout Class
            if (viewName === 'list') {
                grid.classList.remove('layout-grid');
                grid.classList.add('layout-list');
            } else {
                grid.classList.remove('layout-list');
                grid.classList.add('layout-grid');
            }
        }

        // --- 8. RANDOM GENERATOR ---
        randomBtn.addEventListener('click', generatePlan);
        document.getElementById('regenerateBtn').addEventListener('click', generatePlan);
        document.querySelector('.close').onclick = () => modal.style.display = "none";
        window.onclick = (e) => { if(e.target == modal) modal.style.display = "none"; };

        function generatePlan() {
            const getRand = (cat) => {
                const items = recipes.filter(r => r.category === cat);
                return items.length ? items[Math.floor(Math.random() * items.length)] : null;
            };

            const slots = [
                { time: "Wake Up", cat: "Beverages" },
                { time: "Breakfast", cat: "Breakfast" },
                { time: "Lunch", cat: "Main" },
                { time: "Side", cat: "Sides" },
                { time: "Snack", cat: "Snacks" },
                { time: "Dinner", cat: "Soups" }, // Lighter dinner preference
            ];

            let html = '';
            slots.forEach(slot => {
                let item = getRand(slot.cat);
                // Fallbacks
                if (!item && slot.cat === 'Main') item = getRand('Breakfast'); 
                if (!item && slot.cat === 'Dinner') item = getRand('Sides');

                if (item) {
                    html += `
                    <div class="plan-item">
                        <div class="plan-time">${slot.time}</div>
                        <div class="plan-detail">
                            <h4>${item.name}</h4>
                            <span>${item.notes}</span>
                        </div>
                    </div>`;
                }
            });

            document.getElementById('dailyPlanContainer').innerHTML = html;
            modal.style.display = "block";
        }

        // Run
        init();

    </script>
</body>
</html>
